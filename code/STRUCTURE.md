# Stock Report プロジェクト構成ドキュメント

`code/` ディレクトリ配下の Python スクリプトは、データの取得、分析、レポート生成の3つのフェーズに分かれています。

## 1. コア・実行スクリプト

| ファイル名 | 役割 |
| :--- | :--- |
| `main.py` | **プロジェクトのメインエントリポイント**。全体のパイプライン（データ取得 → リスク分析 → 財務分析 → レポート生成）を一括実行し、生成物をブログディレクトリにデプロイします。 |
| `report_generator.py` | **レポート生成エンジン**。各銘柄の Markdown 記事を作成し、チャート画像を統合します。並列処理 (`ThreadPoolExecutor`) を使用して高速に動作します。 |
| `test_run.py` | **開発・テスト用実行スクリプト**。特定の少数銘柄（MSFT, GOOGL等）に限定して全プロセスを実行し、短時間で動作確認を行います。 |

## 2. データ取得・分析モジュール

| ファイル名 | 役割 |
| :--- | :--- |
| `market_data.py` | **市場基本データの管理**。S&P 500 銘柄リストの取得、企業プロファイル、時価総額などの基本情報を `yfinance` や外部 API から収集します。 |
| `risk_return.py` | **テクニカル・リスク分析**。歴史的ボラティリティ (HV) や対数収益率の算出、およびリスク・リターンプロット（Plotly）の生成を担当します。 |
| `fundamentals.py` | **ファンダメンタル分析**。貸借対照表、損益計算書、キャッシュフロー計算書から主要な指標（売上成長率、EPS、配当等）を抽出し、可視化します。 |

## 3. ユーティリティ・補助スクリプト

| ファイル名 | 役割 |
| :--- | :--- |
| `utils.py` | **共通ユーティリティ**。ログ出力 (`run_log.txt`)、`yfinance` へのリクエスト処理（リトライロジック）、セッション管理などを提供します。 |
| `generate_json_only.py` | ブログのフロントエンドで使用する `stocks.json`（銘柄リスト）のみを更新します。 |
| `generate_googl_meta.py` | 特定の銘柄（GOOGL）のメタデータやレポートを個別に修正・再生成します。 |
| `regenerate_blk.py` / `regenerate_spgi.py` | BlackRock (BLK) や S&P Global (SPGI) など、特定の銘柄に対してカスタムデータを用いたレポートの再生成を行います。 |

## データの流れ (Pipeline)

1.  **取得**: `market_data.py` が最新の S&P 500 リストを取得。
2.  **分析**: `risk_return.py` と `fundamentals.py` が各銘柄の数値データを計算・画像化。
3.  **合成**: `report_generator.py` が Markdown テンプレートに分析結果を埋め込み。
4.  **配置**: `main.py` が最終的なファイルを `stock-blog/` フォルダへ移動し、公開準備を完了。
